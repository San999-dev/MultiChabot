<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enhanced Chatbot with Voice & UI</title>
<style>
body {
  margin:0;
  font-family:'Segoe UI', Tahoma, sans-serif;
  overflow:hidden;
  background:#111;
  color:#fff;
}
canvas { position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; }

.chat-container {
  width:400px;
  max-width:90%;
  height:600px;
  background:rgba(0,0,0,0.8);
  border-radius:25px;
  box-shadow:0 10px 25px rgba(0,0,0,0.5);
  display:flex;
  flex-direction:column;
  overflow:hidden;
  margin:auto;
  top:50px;
  position:relative;
  transition:all 0.3s;
}

.top-bar {
  padding:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:linear-gradient(90deg,#007bff,#00d4ff);
  border-radius:25px 25px 0 0;
  font-weight:bold;
  box-shadow:0 3px 8px rgba(0,0,0,0.3);
}

select, button.clear-btn, button.dark-btn {
  padding:6px 12px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  background:#fff;
  font-weight:bold;
  margin-left:5px;
  transition:0.3s;
}
select:hover, button:hover{ transform:scale(1.05); }

.messages {
  flex:1;
  padding:15px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  scroll-behavior:smooth;
}

.message {
  margin:8px 0;
  padding:12px 16px;
  border-radius:22px;
  max-width:75%;
  line-height:1.4;
  word-wrap:break-word;
  opacity:0;
  transform:translateY(10px);
  animation:fadeInUp 0.3s forwards;
}

@keyframes fadeInUp{
  to {opacity:1; transform:translateY(0);}
}

.user {
  background:#007bff;
  color:#fff;
  align-self:flex-end;
  border-bottom-right-radius:5px;
  box-shadow:0 2px 5px rgba(0,0,0,0.2);
}

.bot {
  background:#f1f1f1;
  color:#333;
  align-self:flex-start;
  border-bottom-left-radius:5px;
  box-shadow:0 2px 5px rgba(0,0,0,0.2);
  display:flex;
  align-items:flex-start;
}

.bot span{flex:1;}

.timestamp{
  font-size:10px;
  margin-top:4px;
  text-align:right;
  opacity:0.7;
}

.reactions{
  font-size:16px;
  margin-top:6px;
  display:flex;
  cursor:pointer;
}

.reaction{
  margin-right:8px;
  transition: transform 0.3s, opacity 0.3s;
}
.reaction:hover, .reaction.active{transform:scale(1.5); opacity:0.8;}

.input-container{
  display:flex;
  border-top:1px solid #ddd;
  align-items:center;
  padding:8px;
  background:rgba(0,0,0,0.9);
}
input{
  flex:1;
  border:none;
  padding:12px;
  outline:none;
  font-size:14px;
  border-radius:20px;
}
button.send-btn{
  border:none;
  padding:12px 18px;
  background:#007bff;
  color:white;
  cursor:pointer;
  border-radius:20px;
  margin-left:6px;
  transition:0.3s;
}
button.send-btn:hover{transform:scale(1.05);}

#mic-btn{
  background:#00d4ff;
  color:#111;
  border:none;
  border-radius:50%;
  width:40px;
  height:40px;
  margin-left:6px;
  cursor:pointer;
  font-size:18px;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:0.3s;
}
#mic-btn:hover{transform:scale(1.2);}

#typing{
  font-size:12px;
  color:#ccc;
  padding:5px 15px;
  display:flex;
  align-items:center;
}
.dot{
  width:6px;
  height:6px;
  background:#ccc;
  border-radius:50%;
  margin:0 2px;
  animation: bounce 1s infinite alternate;
}
.dot:nth-child(2){animation-delay:0.2s;}
.dot:nth-child(3){animation-delay:0.4s;}

@keyframes bounce{
  to{transform:translateY(-5px);}
}

body.dark{background:#1e1e1e;}
.dark .chat-container{background:rgba(18,18,18,0.95); color:#fff;}
.dark .top-bar{background:linear-gradient(90deg,#444,#222);}
.dark select, .dark button.clear-btn, .dark button.dark-btn{background:#444; color:white;}
.dark .user{background:#4a90e2;}
.dark .bot{background:#333; color:#eee;}
</style>
</head>
<body>
<canvas id="bgCanvas"></canvas>
<div class="chat-container">
  <div class="top-bar">
    <span>ðŸ¤– Chatbot</span>
    <div>
      <select id="mode">
        <option value="motivation">Motivation</option>
        <option value="joke">Jokes</option>
        <option value="dictionary">Dictionary</option>
      </select>
      <button class="clear-btn" onclick="clearChat()">ðŸ—‘</button>
      <button class="dark-btn" onclick="toggleDarkMode()">ðŸŒ™</button>
    </div>
  </div>
  <div class="messages" id="messages"></div>
  <div id="typing" style="display:none">
    ðŸ¤– Bot is typing <div class="dot"></div><div class="dot"></div><div class="dot"></div>
  </div>
  <div class="input-container">
    <input type="text" id="userInput" placeholder="Type your message...">
    <button id="mic-btn">ðŸŽ¤</button>
    <button class="send-btn" onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
// ---------------- Chat Logic ----------------
const fallbackQuotes = [
  "Believe in yourself â€” Unknown",
  "Every day is a second chance â€” Unknown",
  "Donâ€™t stop until youâ€™re proud â€” Unknown",
  "Difficult roads often lead to beautiful destinations â€” Unknown",
  "Push yourself, because no one else will do it â€” Unknown"
];
const greetings = ["ðŸ‘‹ Hello! Howâ€™s your day?","Hey! ðŸ˜ƒ","Hi friend!","Hello ðŸ‘‹","Hey hey!"];
let conversation = [];

window.onload = ()=>{
  const saved = localStorage.getItem("chatHistory");
  if(saved){conversation=JSON.parse(saved); conversation.forEach(msg=>addMessage(msg.text,msg.sender,false));}
  addMessage("ðŸ‘‹ Welcome! Iâ€™m your chatbot.", "bot");
  initSpeech();
};

// TTS
function speak(text){
  if(!window.speechSynthesis) return;
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang='en-US'; utter.rate=1;
  window.speechSynthesis.speak(utter);
}

// Send message
async function sendMessage(){
  const input=document.getElementById("userInput");
  if(!input.value.trim()) return;
  addMessage(input.value,"user");
  const userText=input.value; input.value="";
  document.getElementById("typing").style.display="flex";
  const reply=await getBotResponse(userText);
  setTimeout(()=>{
    document.getElementById("typing").style.display="none";
    addMessage(reply,"bot");
    speak(reply);
  },800);
}

// Add message
function addMessage(text,sender,save=true){
  const messages=document.getElementById("messages");
  const msg=document.createElement("div");
  msg.classList.add("message",sender);
  msg.innerHTML=`<span>${text}</span><div class="timestamp">${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>`;
  if(sender==="bot"){
    const reactions=document.createElement("div");
    reactions.classList.add("reactions");
    ["ðŸ‘","ðŸ˜‚","â¤ï¸"].forEach(e=>{
      const span=document.createElement("span");
      span.classList.add("reaction");
      span.textContent=e;
      span.onclick = ()=> addMessage(span.textContent,"user");
      reactions.appendChild(span);
    });
    msg.appendChild(reactions);
  }
  messages.appendChild(msg);
  messages.scrollTop=messages.scrollHeight;
  if(save){conversation.push({sender,text}); localStorage.setItem("chatHistory",JSON.stringify(conversation));}
}

// Clear chat
function clearChat(){conversation=[]; localStorage.removeItem("chatHistory"); document.getElementById("messages").innerHTML=""; addMessage("ðŸ‘‹ Welcome! Iâ€™m your chatbot.","bot");}
function toggleDarkMode(){document.body.classList.toggle("dark");}

// Bot response
async function getBotResponse(userInput){
  const mode=document.getElementById("mode").value;
  const text=userInput.trim().toLowerCase();
  if(["hi","hello","hey","hola"].includes(text)) return greetings[Math.floor(Math.random()*greetings.length)];
  if(mode==="motivation"){
    try{const res=await fetch("https://type.fit/api/quotes"); const data=await res.json(); const q=data[Math.floor(Math.random()*data.length)]; return `${q.text} ${q.author?"â€” "+q.author:""}`;}
    catch{return fallbackQuotes[Math.floor(Math.random()*fallbackQuotes.length)];}
  }
  if(mode==="joke"){
    try{const res=await fetch("https://official-joke-api.appspot.com/random_joke"); const data=await res.json(); return data.setup+" ðŸ˜‚ "+data.punchline;}
    catch{return "âš ï¸ Sorry, no jokes right now!";}
  }
  if(mode==="dictionary"){
    if(!text) return "ðŸ“– Please type a word.";
    try{const res=await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${text}`); const data=await res.json(); return `ðŸ“– ${text}: ${data[0].meanings[0].definitions[0].definition}`;}
    catch{return "âš ï¸ Word not found.";}
  }
  return "ðŸ¤” Choose a mode!";
}

document.getElementById("userInput").addEventListener("keypress",e=>{if(e.key==="Enter") sendMessage();});

// STT
function initSpeech(){
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SpeechRecognition) return;
  const recognition = new SpeechRecognition();
  recognition.lang='en-US';
  recognition.interimResults=false;
  document.getElementById("mic-btn").onclick=()=>recognition.start();
  recognition.onresult=(event)=>{
    const text=event.results[0][0].transcript;
    document.getElementById('userInput').value=text;
    sendMessage();
  };
  recognition.onerror=(e)=>console.log("Speech recognition error:",e.error);
}

// 3D Background
const canvas=document.getElementById("bgCanvas"); const ctx=canvas.getContext("2d");
let W,H; function resize(){W=canvas.width=window.innerWidth; H=canvas.height=window.innerHeight;} window.addEventListener("resize",resize); resize();
class Particle{constructor(){this.x=Math.random()*W;this.y=Math.random()*H;this.z=Math.random()*100;this.size=Math.random()*2+1;this.speed=0.5+Math.random()*1;}update(){this.z-=this.speed;if(this.z<=0){this.z=100;this.x=Math.random()*W;this.y=Math.random()*H;}}draw(){const px=(this.x-(W/2))*(100/this.z)+(W/2);const py=(this.y-(H/2))*(100/this.z)+(H/2);const radius=this.size*(100/this.z);ctx.beginPath();ctx.arc(px,py,radius,0,Math.PI*2);ctx.fillStyle="rgba(255,255,255,0.8)";ctx.fill();}}
const particles=[]; for(let i=0;i<200;i++){particles.push(new Particle());} function animate(){ctx.fillStyle="rgba(0,0,0,0.2)"; ctx.fillRect(0,0,W,H); particles.forEach(p=>{p.update();p.draw();}); requestAnimationFrame(animate);} animate();
</script>
</body>
</html>
